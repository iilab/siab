
/**
 * Expose `plugin`.
 */

module.exports = plugin;

/**
 * Metalsmith plugin to manipulate metadata and file metadata. 
 *
 * @return {Function}
 */

function plugin(options){
  return function(files, metalsmith){
    if (options.file) {
      options.file.forEach(function(rule) {
        Object.keys(files).forEach(function(file){
          if (files[file][rule.dest]) {
            files[file][rule.dest] = Object.assign(files[file][rule.dest], files[file][rule.src]);
          } else {
            files[file][rule.dest] = files[file][rule.src];            
          }
        });
      })
    }

    if (options.metadata) {
      options.metadata.forEach(function(rule) {
        if (metalsmith._metadata[rule.dest]) {
          metalsmith._metadata[rule.dest] = Object.assign(metalsmith._metadata[rule.dest], metalsmith._metadata[rule.src]);
        } else {
          metalsmith._metadata[rule.dest] = metalsmith._metadata[rule.src];          
        }
      });
    }
  };
}